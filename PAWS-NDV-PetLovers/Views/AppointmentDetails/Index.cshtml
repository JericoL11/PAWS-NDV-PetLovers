@model PAWS_NDV_PetLovers.ViewModels.AppointmentVm

@{
    ViewData["Title"] = "Index";
}

<div class="bg-secondary bg-opacity-10 py-2 mb-3">
    <div class="container">
        <h1> Appointments </h1>
    </div>
</div>

<div class="container">
    <a class="btn btn-primary" asp-action="Create"> Add Appointment</a>
    <div class="text-end">
        <a class="btn btn-info px-4 fw-bolder text-white" asp-action="AppointmentHistory"> History</a>
    </div>

    <table class="table table-striped">
        <thead>
            <tr>
                <th class="text-center"> Appointment Id </th>
                <th class="text-center"> Name </th>
                <th class="text-center"> Date </th>
                <th class="text-center"> Time </th>
                <th class="text-center"> Service </th>
                <th class="text-center"> Status</th>
                <th class="text-center"> Pet Name </th>
                <th></th>
            </tr>
        </thead>

        <tbody>
            @foreach (var item in Model.IappointmentDetails)
            {
                <tr>
                    <td class="text-center">@Html.DisplayFor(model => item.AppointId)</td>
                    <td class="text-center">@Html.DisplayFor(model => item.Appointment.Owner.fname) @Html.Raw(' ') @Html.DisplayFor(model => item.Appointment.Owner.lname)</td>
                    <td class="text-center">@Html.DisplayFor(model => item.date)</td>
                    <td class="text-center">@Html.DisplayFor(model => item.time)</td>
                    <td class="text-center">@Html.DisplayFor(model => item.services.serviceName)</td>
                    <td class="status-cell text-center">@Html.DisplayFor(model => item.status)</td>
                    <td class="status-cell text-center">@Html.DisplayFor(model => item.Pet.petName)</td>
                    <td>
                        <button type="button" class="btn btn-success set-status-button" data-bs-toggle="modal" data-bs-target="#statusModal" data-status="Success" data-id="@item.AppointId_details">
                            Set as Success
                        </button>
                        <button type="button" class="btn btn-danger set-status-button" data-bs-toggle="modal" data-bs-target="#statusModal" data-status="Failed" data-id="@item.AppointId_details">
                            Set as Failed
                        </button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<!-- Modal for status change -->
<div class="modal fade" id="statusModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="statusModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="statusModalLabel">Warning!</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure to set this appointment as <span id="modalStatusText"></span>?
            </div>
            <div class="modal-footer">
                <form asp-action="SetStatus" method="post">
                    <input type="hidden" name="AppointId_details" id="modalAppointIdDetails" />
                    <input type="hidden" name="statusSelect" id="modalStatusSelect" />
                    <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">No</button>
                    <button type="submit" class="btn btn-primary px-4">Yes</button>
                </form>
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    $(document).ready(function () {
        // Iterate over each element with the class 'status-cell'
        $('.status-cell').each(function () {
            // Get the text content of the current element and trim any leading/trailing whitespace
            var status = $(this).text().trim();
            // If the status text is empty
            if (!status) {
                // Set the text content of the current element to 'Pending'
                $(this).text('Pending');
            }
        });

        // Add a click event listener to elements with the class 'set-status-button'
        $('.set-status-button').on('click', function () {
            // Get the 'data-status' attribute of the clicked button
            var status = $(this).data('status');
            // Get the 'data-id' attribute of the clicked button
            var id = $(this).data('id');
            // Set the text content of the element with ID 'modalStatusText' to the status
            $('#modalStatusText').text(status);
            // Set the value of the hidden input field with ID 'modalStatusSelect' to the status
            $('#modalStatusSelect').val(status);
            // Set the value of the hidden input field with ID 'modalAppointIdDetails' to the appointment ID
            $('#modalAppointIdDetails').val(id);
        });
    });
</script>
